(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var a in s)e.o(s,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:s[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,s=window.wp.apiFetch;var a=e.n(s);const o=window.wp.url,n=window.wp.i18n,r=(e,t)=>{let s=Object.assign({},e);switch(t.type){case"FETCH_SITES":s.fetchedSites=t.payload.fetchedSites,s.stateSites=t.payload.stateSites,s.isPending=!1,s.canSave=!1,void 0!==t.payload.fetchedSites.copy_wpmu_posts_fetch_ssubsites_errors&&(s.notice=(0,n.__)("An error occurred.","copy-wpmu-posts"),s.hasError=!0);break;case"COPY_TO_SUBSITE_BEFORE":s.isPending=t.payload.isPending,s.newPostData={},s.statePostData={};break;case"COPY_TO_SUBSITE":s.newPostData=t.payload.newPostData,s.statePostData=t.payload.statePostData,s.isPending=!1;let e=!1,a=(0,n.__)("Saved Successfully.","copy-wpmu-posts"),o=!1;void 0!==t.payload.newPostData.copy_wpmu_posts_copy_to_subsites_errors&&(e=!0,a=(0,n.__)("An error occurred.","copy-wpmu-posts"),o=!0),s.canSave=e,s.notice=a,s.hasError=o;break;case"UPDATE_STATE":t.payload.fetchedSites&&(s.fetchedSites=t.payload.fetchedSites),t.payload.stateSites&&(s.stateSites=t.payload.stateSites),void 0!==t.payload.isPending&&(s.isPending=t.payload.isPending),void 0!==t.payload.notice&&(s.notice=t.payload.notice),void 0!==t.payload.hasError&&(s.hasError=t.payload.hasError),void 0!==t.payload.canSave&&(s.canSave=t.payload.canSave)}return s},i=window.ReactJSXRuntime,c=(0,t.createContext)(),d=e=>{const[s,n]=(0,t.useReducer)(r,{fetchedSites:{},stateSites:{},isPending:!0,notice:"",hasError:"",canSave:!1,newPostData:{}}),d=async()=>{const e=await(async()=>{let e={};try{e=await a()({path:"copywpmuposts/v1/getsubsites",method:"GET",headers:{"X-WP-Nonce":copy_wpmu_js_data?.rest_nonce}})}catch(e){return console.log("fetchSubSites Errors:",e),{copy_wpmu_posts_fetch_ssubsites_errors:!0}}return e})();n({type:"FETCH_SITES",payload:{fetchedSites:e,stateSites:e}})};(0,t.useEffect)((()=>{d()}),[]);let p={useDispatch:e=>{n(e)},useFetchSites:d,useUpdateState:async e=>{n({type:"UPDATE_STATE",payload:e})},useCopySiteData:async e=>{n({type:"COPY_TO_SUBSITE_BEFORE",payload:{isPending:!0}});const t=await(async e=>{let t="copywpmuposts/v1/copytosubsite",s=[],n={post_id:e?.post_id,site_id:e?.site_id};t=(0,o.addQueryArgs)(t,n);try{s=await a()({path:t,method:"POST",headers:{"X-WP-Nonce":copy_wpmu_js_data?.rest_nonce}})}catch(e){return console.log("copySiteData Errors:",e),{copy_wpmu_posts_copy_to_subsites_errors:!0}}return s})(e);n({type:"COPY_TO_SUBSITE",payload:{newPostData:t,statePostData:t}})},useSites:s.stateSites,useIsPending:s.isPending,useNotice:s.notice,useHasError:s.hasError,useCanSave:s.canSave,useNewPostData:s.statePostData};return(0,i.jsx)(c.Provider,{value:p,children:e.children})},p=window.wp.components,u=()=>{const{useSites:e,useNewPostData:s,useIsPending:a,useCopySiteData:o}=(0,t.useContext)(c),[r,d]=(0,t.useState)(0),[u,l]=(0,t.useState)([]);return(0,t.useEffect)((()=>{if(!e||!e.data)return;if(!1===e.success)return;let t=[];e.data.forEach((e=>t.push({label:e.path,value:e.blog_id}))),l(t)}),[e]),Object.keys(e).length?(0,i.jsxs)("div",{children:[u.length>0&&(0,i.jsx)(p.RadioControl,{label:(0,n.__)("Select destination site","copy-wpmu-posts"),selected:r,options:u,onChange:e=>d(e)}),0!==r&&(0,i.jsx)("div",{style:{display:"flex",width:"100%",justifyContent:"end",marginTop:"10px"},children:(0,i.jsxs)(p.Button,{variant:"primary",onClick:()=>o({site_id:r,post_id:copy_wpmu_js_data?.post_id}),children:[(0,i.jsx)("span",{children:(0,n.__)("Continue","copy-wpmu-posts")}),a&&(0,i.jsx)(p.Spinner,{})]})}),!a&&s&&(0,i.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"end",marginTop:"10px"},children:[s.success&&!0===s.success&&(0,i.jsxs)(p.Notice,{status:"success",children:["Successfully copied to ",(0,i.jsx)("a",{href:s.data.target_url,target:"_blank",children:s.data.target_url})]}),s.success&&!1===s.success||s.copy_wpmu_posts_copy_to_subsites_errors&&(0,i.jsx)(p.Notice,{status:"error",children:"An error occurred while copying. "})]})]}):(0,i.jsx)(p.Spinner,{})},l=()=>(0,i.jsx)(d,{children:(0,i.jsx)(u,{})}),_=document.getElementById("copy-wpmu-posts");_&&document.addEventListener("DOMContentLoaded",(()=>{(0,t.createRoot)(_).render((0,i.jsx)(l,{}))}))})();